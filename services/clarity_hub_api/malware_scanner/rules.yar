/*
    EICAR Test Virus Signature
    This rule detects the EICAR test file - a standard anti-malware test file
    Safe to use for testing antivirus/anti-malware detection
*/

rule EICAR_Test_File {
    meta:
        description = "EICAR Anti-Virus Test File"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        reference = "http://www.eicar.org/86-0-Intended-use.html"
        severity = "high"
        malware_type = "test_file"
    
    strings:
        $eicar_string = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
    
    condition:
        $eicar_string
}

/*
    EICAR COM Variant
    Detects EICAR in COM executable format
*/

rule EICAR_COM_File {
    meta:
        description = "EICAR Anti-Virus Test File (COM format)"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "high"
        malware_type = "test_file"
    
    strings:
        $eicar_com = { 58 35 4F 21 50 25 40 41 50 5B 34 5C 50 5A 58 35 34 28 50 5E 29 37 43 43 29 37 7D 24 45 49 43 41 52 2D 53 54 41 4E 44 41 52 44 2D 41 4E 54 49 56 49 52 55 53 2D 54 45 53 54 2D 46 49 4C 45 21 24 48 2B 48 2A }
    
    condition:
        $eicar_com at 0
}

/*
    Suspicious PowerShell Patterns
    Detects common malicious PowerShell command patterns
*/

rule Suspicious_PowerShell_Download {
    meta:
        description = "Suspicious PowerShell download pattern"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "critical"
        malware_type = "downloader"
    
    strings:
        $powershell1 = "powershell" nocase
        $download1 = "DownloadFile" nocase
        $download2 = "WebClient" nocase
        $download3 = "Invoke-WebRequest" nocase
        $download4 = "IEX" nocase
        $download5 = "iwr" nocase
        $exec1 = "-ExecutionPolicy Bypass" nocase
        $exec2 = "-NoProfile" nocase
        $hidden = "-WindowStyle Hidden" nocase
    
    condition:
        $powershell1 and (
            ($download1 or $download2 or $download3 or $download4 or $download5) and
            ($exec1 or $exec2 or $hidden)
        )
}

/*
    Base64 Encoded PowerShell
    Detects base64-encoded PowerShell commands (common obfuscation technique)
*/

rule Base64_Encoded_PowerShell {
    meta:
        description = "Base64 encoded PowerShell command"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "high"
        malware_type = "obfuscated_script"
    
    strings:
        $ps1 = "powershell" nocase
        $ps2 = "pwsh" nocase
        $enc1 = "-EncodedCommand" nocase
        $enc2 = "-enc" nocase
        $base64 = /[A-Za-z0-9+\/]{50,}={0,2}/
    
    condition:
        ($ps1 or $ps2) and ($enc1 or $enc2) and $base64
}

/*
    Reverse Shell Indicators
    Detects common reverse shell patterns
*/

rule Suspicious_Reverse_Shell {
    meta:
        description = "Potential reverse shell command"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "critical"
        malware_type = "backdoor"
    
    strings:
        $bash1 = "/bin/bash"
        $bash2 = "/bin/sh"
        $netcat1 = "nc -e"
        $netcat2 = "ncat -e"
        $python1 = "socket.socket"
        $python2 = "subprocess.call"
        $pipe = "/dev/tcp/"
    
    condition:
        (($bash1 or $bash2) and $pipe) or
        ($netcat1 or $netcat2) or
        ($python1 and $python2)
}

/*
    Cryptocurrency Miner Indicators
    Detects common crypto mining malware patterns
*/

rule Cryptocurrency_Miner {
    meta:
        description = "Potential cryptocurrency mining malware"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "high"
        malware_type = "cryptominer"
    
    strings:
        $miner1 = "xmrig" nocase
        $miner2 = "cpuminer" nocase
        $miner3 = "ethminer" nocase
        $pool1 = "stratum+tcp://" nocase
        $pool2 = "stratum+ssl://" nocase
        $wallet1 = /4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}/  // Monero address
        $wallet2 = /0x[a-fA-F0-9]{40}/  // Ethereum address
    
    condition:
        ($miner1 or $miner2 or $miner3) or
        (($pool1 or $pool2) and ($wallet1 or $wallet2))
}

/*
    Ransomware Indicators
    Detects common ransomware file extension changes
*/

rule Ransomware_Extension_Change {
    meta:
        description = "Potential ransomware extension patterns"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "critical"
        malware_type = "ransomware"
    
    strings:
        $ext1 = ".encrypted" nocase
        $ext2 = ".locked" nocase
        $ext3 = ".crypto" nocase
        $ext4 = ".WNCRY" nocase
        $ext5 = ".wannacry" nocase
        $ransom1 = "DECRYPT" nocase
        $ransom2 = "RANSOM" nocase
        $ransom3 = "bitcoin" nocase
        $file_op = "CryptEncrypt"
    
    condition:
        ($ext1 or $ext2 or $ext3 or $ext4 or $ext5) or
        (($ransom1 or $ransom2) and ($ransom3 or $file_op))
}

/*
    Suspicious Registry Modification
    Detects registry persistence mechanisms
*/

rule Suspicious_Registry_Persistence {
    meta:
        description = "Potential registry persistence mechanism"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "high"
        malware_type = "persistence"
    
    strings:
        $reg1 = "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" nocase
        $reg2 = "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" nocase
        $reg3 = "RunOnce" nocase
        $cmd1 = "reg add" nocase
        $cmd2 = "Set-ItemProperty" nocase
    
    condition:
        ($reg1 or $reg2 or $reg3) and ($cmd1 or $cmd2)
}

/*
    Suspicious File Deletion
    Detects mass file deletion patterns (potential wiper malware)
*/

rule Suspicious_Mass_File_Deletion {
    meta:
        description = "Potential wiper malware or destructive script"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "critical"
        malware_type = "wiper"
    
    strings:
        $del1 = "rm -rf" nocase
        $del2 = "del /f /s /q" nocase
        $del3 = "Remove-Item -Recurse -Force" nocase
        $wildcard1 = "/*"
        $wildcard2 = "C:\\"
        $wildcard3 = "*.*"
    
    condition:
        ($del1 or $del2 or $del3) and ($wildcard1 or $wildcard2 or $wildcard3)
}

/*
    SSH Key Theft
    Detects attempts to access SSH private keys
*/

rule SSH_Key_Theft {
    meta:
        description = "Potential SSH key theft attempt"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "high"
        malware_type = "credential_theft"
    
    strings:
        $ssh1 = "/.ssh/id_rsa"
        $ssh2 = "/.ssh/id_dsa"
        $ssh3 = "/.ssh/id_ecdsa"
        $ssh4 = "/.ssh/id_ed25519"
        $cmd1 = "cat" nocase
        $cmd2 = "cp" nocase
        $cmd3 = "curl" nocase
        $cmd4 = "wget" nocase
    
    condition:
        ($ssh1 or $ssh2 or $ssh3 or $ssh4) and ($cmd1 or $cmd2 or $cmd3 or $cmd4)
}

/*
    Keylogger Indicators
    Detects common keylogger patterns
*/

rule Keylogger_Indicators {
    meta:
        description = "Potential keylogger detection"
        author = "Voltaxe Security Team"
        date = "2025-10-03"
        severity = "critical"
        malware_type = "keylogger"
    
    strings:
        $api1 = "GetAsyncKeyState"
        $api2 = "GetKeyboardState"
        $api3 = "SetWindowsHookEx"
        $hook = "WH_KEYBOARD_LL"
        $log1 = "keylog" nocase
        $log2 = "keystroke" nocase
    
    condition:
        ($api1 or $api2 or ($api3 and $hook)) or ($log1 or $log2)
}
